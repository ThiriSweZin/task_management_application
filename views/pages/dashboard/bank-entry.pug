extends ../../includes/layout-dashboard

block content
  ol.breadcrumb
    li.breadcrumb-item
      a(href="/dashboard") Home
    li.breadcrumb-item
      a(href="/bank") Bank Info
    li.breadcrumb-item.active
      span Entry
  h1.page-header Bank Info Entry
  div.row.from-wrapper
    div.alert.alert-dismissible#alert(role='alert')
      strong.alert-title#alertTitle
      span#alertMessage
      button.close(type='button', data-hide='alert', aria-label='Close')
        span(aria-hidden='true') &times;

    form.form-horizontal#entryForm(method='post', action=`${postUrl}`, enctype="application/x-www-form-urlencoded", autocomplete='off')
      input#recordid(type='hidden', name='id', value=params.id)
      input#createddate(type='hidden', name='createddate', value=params.createddate)
      input#banks(type='hidden', name='banks', value=banks)
      
      div.form-group.row
        label.col-sm-2.control-label(for="") Logo

        div.col-sm-3
          div.form-image#logoContainer
            div.image-add-continer
              button.btn.btn-light.image-add#btnLogoAdd(type="button")
                span.fa.fa-plus(aria-hidden= true)
            div.image-preview-container
              input#logo(type="hidden", name="logo", value=params.logo)
              img.form-image-preview.image-preview
              div.image-delete-container
                a.image-delete(title='Remove')
                  i.fa.fa-trash

      div.text-right#bank-name
      div.form-group.row
        label.col-sm-2.control-label(for='bank') Bank Name
        div.col-sm-10
          input.form-control#bank(type='text', name='bank', value=params.bank, required autofocus)

      div.form-group.row
        label.col-sm-2.control-label(for='account') Account No
        div.col-sm-10
          input.form-control#account(type='text', name='account', value=params.account, required, maxlength="20")

      div.form-group.row
        label.col-sm-2.control-label(for='ownername') Owner's Name
        div.col-sm-10
          input.form-control#ownername(type='text', name='ownername', value=params.ownername, required)

      div.row.justify-content-center.form-actions
        button.btn.btn-primary#submitBtn(type='submit', role='button') Save
        a.btn.btn-secondary#actionCancel(href=listUrl, role='button') Cancel

    form#postSuccessForm(method='GET', action=listUrl)

  script(src='/js/upload.js')
  script(src='/js/scripts-upload.js')
  script.
    var token = "!{token}";

    $('div.sidebar-sticky li.nav-item').removeClass('active');
    $('li#menu-bank').addClass('active');
    $('div#general_subitems').addClass('show');

    $("#bank-name").hide();
    $("#bank").on('change keyup',function(){
      var ori_bank = $("#banks").val();
      ori_bank = JSON.parse(ori_bank);
      var new_bank = $("#bank").val();
      var account = $("#account").val();
      var isExit = false;
      var submitBtn = document.getElementById("submitBtn");
      
      ori_bank.forEach(bank => {
        if (!isExit) {
          if (bank.bank == new_bank && bank.account == account) {
            isExit = true;
            $("#bank-name").html("Already Exist!").addClass('text-danger').show();
            
            submitBtn.setAttribute("disabled", "");
          }
        }
      })
      if (!isExit) {
        $("#bank-name").hide();
        submitBtn.removeAttribute("disabled");
      }
    });

    $("#account").on('change keyup',function(){
      var ori_bank = $("#banks").val();
      ori_bank = JSON.parse(ori_bank);
      var new_bank = $("#bank").val();
      var account = $("#account").val();
      var isExit = false;
      var submitBtn = document.getElementById("submitBtn");
      
      ori_bank.forEach(bank => {
        if (!isExit) {
          if (bank.bank == new_bank && bank.account == account) {
            isExit = true;
            $("#bank-name").html("Already Exist!").addClass('text-danger').show();
            
            submitBtn.setAttribute("disabled", "");
          }
        }
      })
      if (!isExit) {
        $("#bank-name").hide();
        submitBtn.removeAttribute("disabled");
      }
    });

    $('a.image-delete').on('click', function(ev) {
      if (confirm('Are you sure to remove this image?')) {
        $("#logo").val('');
        $('img.image-preview').attr('src', '');
        $('.image-add-continer').show();
        $('.image-preview-container').hide();
      }
      //- $("#bank").val("");
    })

  script(src='/js/bank-entry.js')
